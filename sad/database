-- ==============================
-- INVENTORY MANAGEMENT SYSTEM
-- Oracle Database Setup Script
-- ==============================

-- Drop existing tables if they exist
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE sales CASCADE CONSTRAINTS';
EXCEPTION
   WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE stock CASCADE CONSTRAINTS';
EXCEPTION
   WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE products CASCADE CONSTRAINTS';
EXCEPTION
   WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE categories CASCADE CONSTRAINTS';
EXCEPTION
   WHEN OTHERS THEN NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE users2 CASCADE CONSTRAINTS';
EXCEPTION
   WHEN OTHERS THEN NULL;
END;
/

-- Create users table
CREATE TABLE users2 (
    user_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(100) NOT NULL,
    email VARCHAR2(100) UNIQUE NOT NULL,
    password VARCHAR2(100) NOT NULL,
    role VARCHAR2(20) DEFAULT 'user' CHECK (role IN ('admin', 'user')),
    created_date DATE DEFAULT SYSDATE
);

-- Create categories table
CREATE TABLE categories (
    category_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    category_name VARCHAR2(100) NOT NULL UNIQUE,
    created_date DATE DEFAULT SYSDATE
);

-- Create products table
CREATE TABLE products (
    product_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_name VARCHAR2(100) NOT NULL,
    category_id NUMBER NOT NULL,
    quantity NUMBER DEFAULT 0,
    price NUMBER(10,2) NOT NULL,
    description VARCHAR2(200),
    created_date DATE DEFAULT SYSDATE,
    CONSTRAINT fk_category FOREIGN KEY (category_id) REFERENCES categories(category_id) ON DELETE CASCADE
);

-- Create stock table
CREATE TABLE stock (
    stock_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id NUMBER NOT NULL,
    stock_in NUMBER DEFAULT 0,
    stock_out NUMBER DEFAULT 0,
    stock_date DATE DEFAULT SYSDATE,
    CONSTRAINT fk_stock_product FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE CASCADE
);

-- Create sales table
CREATE TABLE sales (
    sale_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id NUMBER NOT NULL,
    quantity_sold NUMBER NOT NULL,
    sale_date DATE DEFAULT SYSDATE,
    CONSTRAINT fk_sales_product FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE CASCADE
);

-- Insert default admin user
-- Password: admin123
INSERT INTO users2 (name, email, password, role) 
VALUES ('Admin User', 'admin@gmail.com', 'admin123', 'admin');

-- Insert sample categories
INSERT INTO categories (category_name) VALUES ('Electronics');
INSERT INTO categories (category_name) VALUES ('Furniture');
INSERT INTO categories (category_name) VALUES ('Clothing');
INSERT INTO categories (category_name) VALUES ('Books');
INSERT INTO categories (category_name) VALUES ('Food & Beverages');

-- Insert sample products
INSERT INTO products (product_name, category_id, quantity, price, description) 
VALUES ('Laptop', 1, 50, 45000.00, 'Dell Inspiron 15 laptop');

INSERT INTO products (product_name, category_id, quantity, price, description) 
VALUES ('Office Chair', 2, 30, 5500.00, 'Ergonomic office chair');

INSERT INTO products (product_name, category_id, quantity, price, description) 
VALUES ('T-Shirt', 3, 100, 500.00, 'Cotton T-shirt');

-- Insert sample stock entries
INSERT INTO stock (product_id, stock_in, stock_out) VALUES (1, 50, 0);
INSERT INTO stock (product_id, stock_in, stock_out) VALUES (2, 30, 0);
INSERT INTO stock (product_id, stock_in, stock_out) VALUES (3, 100, 0);

-- Insert sample sales
INSERT INTO sales (product_id, quantity_sold) VALUES (1, 5);
INSERT INTO sales (product_id, quantity_sold) VALUES (2, 3);

COMMIT;

-- Display success message
SELECT 'Database setup completed successfully!' AS STATUS FROM DUAL;